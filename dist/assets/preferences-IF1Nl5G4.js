import"./base-DW4XMzFu.js";import{g as _,H as C}from"./restaurant-CdretbXj.js";const c=e=>document.querySelector(e),D=c("#foodForm"),w=c("#results"),f=c("#resultsBtn"),F=c("#foodCategory"),B=c("#zip"),O=c("#price-range"),Y=c("#movieForm"),P=c("#movieResults"),d=c("#movieResultsBtn"),J=c("#movieGenre"),j=c("#minYear");let v=null,$=null;const g=[],h=[],M="favoriteList";function l(e){w&&(w.innerHTML=e)}function u(e){P&&(P.innerHTML=e)}function I(){g.splice(0).forEach(clearTimeout)}function T(){h.splice(0).forEach(clearTimeout)}function z(e,r){I(),g.push(setTimeout(()=>{l(`<p>Searching for <strong>${r}</strong> near ${e}…</p>`)},0)),g.push(setTimeout(()=>{l("<p>Still looking… the provider can be slow during busy times.</p>")},8e3)),g.push(setTimeout(()=>{l("<p>Almost there… thanks for your patience.</p>")},2e4))}function H(e,r){T(),h.push(setTimeout(()=>{u(`<p>Searching for <strong>${r}</strong> movies since <strong>${e}</strong>…</p>`)},0)),h.push(setTimeout(()=>{u("<p>Still looking… the movie provider can be slow during peak times.</p>")},8e3)),h.push(setTimeout(()=>{u("<p>Almost there… thanks for your patience.</p>")},2e4))}function E(e){if(console.error("Search error:",e),e?.name==="AbortError")return"Search was canceled.";if(e instanceof C){const r=e.status;return r===401||r===403?"Authorization problem with the search service.":r===404?"The search service endpoint was not found.":r===400||r===422?"Please pick a category and enter a valid 5-digit ZIP.":r===429?"Too many searches. Wait a minute and try again.":r>=500&&r<=504?"The searching had a hiccup. Try again soon.":`Unexpected error (code ${r}).`}return/NetworkError|Failed to fetch/i.test(e?.message)?"Network error — check your connection.":/Missing VITE_RAPIDAPI_KEY/i.test(e?.message)?"Missing API key (dev-only).":"Something went wrong. Please try again."}function k(){try{return JSON.parse(localStorage.getItem(M)||"[]")}catch{return[]}}function K(e){localStorage.setItem(M,JSON.stringify(e||[]))}function L(e,r){return k().some(t=>t.type===e&&t.name===r)}const N=(e,r)=>`foodCache:${e}:${r}`;function q(e,r,t){localStorage.setItem(N(e,r),JSON.stringify({ts:Date.now(),items:t}))}function G(e,r){try{return JSON.parse(localStorage.getItem(N(e,r)))}catch{return null}}const R=(e,r)=>`moviesCache:${e}:${r}`;function V(e,r,t){localStorage.setItem(R(e,r),JSON.stringify({ts:Date.now(),items:t}))}function Z(e,r){try{return JSON.parse(localStorage.getItem(R(e,r)))}catch{return null}}function W(e){if(!e)return null;const r=(e.match(/(\d+(?:\.\d{1,2})?)/g)||[]).map(Number);return r.length>=2?{min:r[0],max:r[1]}:r.length===1&&/more/i.test(e)?{min:r[0],max:1/0}:null}function Q(e){const r=(e||"").match(/\$/g)?.length||0;return r===1?{min:0,max:10}:r===2?{min:10,max:20}:r===3?{min:20,max:30}:r>=4?{min:30,max:1/0}:null}function X(e){if(typeof e?.price=="number")return e.price;if(typeof e?.priceValue=="number")return e.priceValue;if(typeof e?.priceUSD=="number")return e.priceUSD;if(typeof e?.price_in_cents=="number")return e.price_in_cents/100;if(typeof e?.priceCents=="number")return e.priceCents/100;const t=(e?.price?.toString()||e?.description?.toString()||e?.desc?.toString()||e?.subtitle?.toString()||"").match(/(\d+(?:\.\d{1,2})?)/);return t?Number(t[1]):null}function ee(e){return(e?.priceRange||e?.price_level||e?.priceLevel||e?.pricing||e?.priceTag||"").toString().match(/\$+/)?.[0]||""}function te(e,{min:r,max:t}){return!(e==null||r!=null&&e<r||t!=null&&e>t)}function b(e,r){if(!r)return e;const t=W(r);return t?(e||[]).filter(s=>{const i=X(s);if(i!=null)return te(i,t);const n=ee(s),a=Q(n);return n&&a?(a.min??-1/0)<=(t.max??1/0)&&(t.min??-1/0)<=(a.max??1/0):!1}):e}function S(e=[]){if(!e?.length){l("<p>No results found. Try another category or ZIP.</p>");return}const r=e.filter(t=>!!(t?.imageUrl||t?.image||t?.img||t?.thumbnail||t?.photoUrl||null)).slice(0,5).map(t=>{const s=t?.name||t?.title||"Unnamed item",i=t?.price?` · ${t.price}`:"",n=t?.description||t?.desc||"",a=t?.imageUrl||t?.image||t?.img||t?.thumbnail||t?.photoUrl||null,o=L("food",s),m=`<img src="${a}" alt="Image of ${s}" onerror="this.style.display='none'">`;return`
        <article class="card" data-type="food" data-name="${s}">
          <button type="button" class="heart-btn ${o?"is-fav":""}" aria-pressed="${o}">${o?"❤️":"♡"}</button>
          ${m}
          <div class="card-content">
            <h3>${s}${i}</h3>
            ${n?`<p class="desc">${n}</p>`:""}
          </div>
        </article>
      `}).join("");l(`<div class="grid">${r}</div>`)}function x(e){return[e?.primaryImage?.url,typeof e?.primaryImage=="string"?e.primaryImage:null,...Array.isArray(e?.thumbnails)?e.thumbnails.map(t=>t?.url):[],e?.posterUrl,e?.Poster,e?.poster,e?.imageUrl,e?.image,e?.img,e?.thumbnail].filter(Boolean).find(t=>typeof t=="string"&&/^https?:\/\//i.test(t))||null}function A(e=[]){if(!e?.length){u("<p>No movies found. Try another genre or year.</p>");return}const r=e.filter(t=>!!x(t)).slice(0,5).map(t=>{const s=t?.primaryTitle||t?.originalTitle||t?.Title||t?.title||t?.name||t?.original_title||t?.titleText?.text||"Untitled",i=t?.startYear||t?.Year||t?.year||(t?.release_date?new Date(t.release_date).getFullYear():""),n=t?.Rating||t?.rating||t?.vote_average,a=t?.description||t?.plot||t?.synopsis||"",o=t?.runtimeMinutes||t?.RuntimeMinutes||t?.runtime||"",p=`<img src="${x(t)}" alt="Poster of ${s}" title="${s}" onerror="this.style.display='none'">`,U=[i?`(${i})`:"",n?`⭐ ${n}`:"",o?`⏱️ ${o} min`:""].filter(Boolean).join(" "),y=L("movie",s);return`
        <article class="card" data-type="movie" data-title="${s}">
          <button type="button" class="heart-btn ${y?"is-fav":""}" aria-pressed="${y}">${y?"❤️":"♡"}</button>
          ${p}
          <div class="card-content">
            <h3>${s}</h3>
            <p class="meta">${U}</p>
            ${a?`<p class="desc">${a}</p>`:""}
          </div>
        </article>
      `}).join("");u(`<div class="grid">${r}</div>`)}async function re(e){e.preventDefault();const r=F?.value?.trim(),t=(B?.value||"").trim(),s=O?.value?.trim()||"";if(!r||!/^\d{5}$/.test(t)){l("<p>Please pick a category and enter a valid 5-digit ZIP.</p>");return}f&&(f.disabled=!0);const i=G(t,r);if(i?.items?.length)l('<p class="muted">Showing saved results while fetching fresh data…</p>'),S(b(i.items,s));else{const n=s?` under ${s.replace(/ or more/i,"+")}`:"";l(`<p>Searching for <strong>${r}</strong> near ${t}${n}…</p>`)}v?.abort(),v=new AbortController,z(t,r);try{const n=await _({address:t,resName:r},{signal:v.signal}),a=Array.isArray(n)?n:Array.isArray(n?.data)?n.data:Array.isArray(n?.results)?n.results:Array.isArray(n?.items)?n.items:[];I();const o=b(a,s);S(o),q(t,r,a)}catch(n){I();const a=E(n);i?.items?.length?(l(`<p>${a} — showing saved results from earlier.</p>`),S(b(i.items,s))):l(`<p>${a}</p>`)}finally{f&&(f.disabled=!1)}}async function ne(e){e.preventDefault();const r=J?.value?.trim(),t=(j?.value||"").trim();if(!r||!/^\d{4}$/.test(t)){u("<p>Please pick a genre and enter a 4-digit minimum year (e.g., 2020).</p>");return}d&&(d.disabled=!0);const s=Z(t,r);s?.items?.length?(u('<p class="muted">Showing saved results while fetching fresh data…</p>'),A(s.items)):u(`<p>Searching for <strong>${r}</strong> movies since <strong>${t}</strong>…</p>`),$?.abort(),$=new AbortController,H(t,r);try{const i=`/.netlify/functions/moviesSearch?${new URLSearchParams({MinYear:t,Genre:r})}`,n=await fetch(i,{signal:$.signal,headers:{accept:"application/json"}});if(!n.ok)throw new C(n.status,n.statusText);const a=await n.json(),o=Array.isArray(a)?a:Array.isArray(a?.items)?a.items:Array.isArray(a?.results)?a.results:Array.isArray(a?.data)?a.data:[];T(),A(o),V(t,r,o)}catch(i){T();const n=E(i);s?.items?.length?(u(`<p>${n} — showing saved results from earlier.</p>`),A(s.items)):u(`<p>${n}</p>`)}finally{d&&(d.disabled=!1)}}document.addEventListener("DOMContentLoaded",()=>{D?.addEventListener("submit",re),Y?.addEventListener("submit",ne)});document.addEventListener("click",e=>{if(!e.target.classList.contains("heart-btn"))return;e.preventDefault();const r=e.target;r.hasAttribute("type")||r.setAttribute("type","button");const t=r.closest(".card");if(!t)return;const s=t.dataset.type,i=s==="movie"?t.dataset.title:t.dataset.name,n=t.querySelector("img")?.src||"",a=t.querySelector(".desc")?.textContent||"";let o=k();const m=o.findIndex(p=>p.name===i&&p.type===s);m===-1?(o.push({type:s,name:i,image:n,description:a}),r.textContent="❤️",r.classList.add("is-fav"),r.setAttribute("aria-pressed","true")):(o.splice(m,1),r.textContent="♡",r.classList.remove("is-fav"),r.setAttribute("aria-pressed","false")),K(o)});
