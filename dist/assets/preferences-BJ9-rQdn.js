import"./base-DQM_IlgI.js";import{g as E,H as b}from"./restaurant-CdretbXj.js";const l=e=>document.querySelector(e),M=l("#foodForm"),S=l("#results"),m=l("#resultsBtn"),C=l("#foodCategory"),N=l("#zip");let h=null;const p=[];function i(e){S&&(S.innerHTML=e)}function f(e=[]){if(!e?.length){i("<p>No results found. Try another category or ZIP.</p>");return}const t=e.slice(0,5).map(r=>{const a=r?.name||r?.title||"Unnamed item",s=r?.price?` · ${r.price}`:"",n=r?.imageUrl||r?.image||r?.img||r?.thumbnail||r?.photoUrl||null;return`
      <article class="card">
        ${n?`<img src="${n}" alt="" onerror="this.style.display='none'">`:""}
        <h3>${a}</h3>
        <p>${s}</p>
      </article>
    `}).join("");i(`<div class="grid">${t}</div>`)}const T=(e,t)=>`ddc:cache:${e}:${t}`;function U(e,t,r){localStorage.setItem(T(e,t),JSON.stringify({ts:Date.now(),items:r}))}function R(e,t){try{return JSON.parse(localStorage.getItem(T(e,t)))}catch{return null}}function P(e){if(console.error("Search error:",e),e.name==="AbortError")return"Search was canceled.";if(e instanceof b){const t=e.status;return t===401||t===403?"Authorization problem with the search service. Please try again shortly.":t===404?"The search service endpoint was not found.":t===400||t===422?"Please pick a category and enter a valid 5-digit ZIP.":t===429?"We’re searching a bit too fast. Wait a minute and try again.":t>=500&&t<=504?"The food search service had a hiccup. Try again in a moment.":`Unexpected error (code ${t}).`}return/NetworkError|Failed to fetch/i.test(e.message)?"Network error — please check your connection.":/Missing VITE_RAPIDAPI_KEY/i.test(e.message)?"Setup issue: missing API key (dev-only).":"Something went wrong. Please try again."}function $(){p.splice(0).forEach(clearTimeout)}function D(e,t){$(),p.push(setTimeout(()=>{i(`<p>Searching for <strong>${t}</strong> near ${e}…</p>`)},0)),p.push(setTimeout(()=>{i("<p>Still looking… the provider can be slow during busy times.</p>")},8e3)),p.push(setTimeout(()=>{i("<p>Almost there… thanks for your patience.</p>")},2e4))}async function L(e){e.preventDefault();const t=C?.value?.trim(),r=N?.value?.trim();if(!t||!/^\d{5}$/.test(r||"")){i("<p>Please pick a category and enter a valid 5-digit ZIP.</p>");return}m&&(m.disabled=!0);const a=R(r,t);a?.items?.length?(i('<p class="muted">Showing saved results from earlier while we fetch fresh data…</p>'),f(a.items)):i(`<p>Searching for <strong>${t}</strong> near ${r}…</p>`),h?.abort(),h=new AbortController,D(r,t);try{const s=await E({address:r,resName:t},{signal:h.signal}),n=Array.isArray(s)?s:Array.isArray(s?.data)?s.data:Array.isArray(s?.results)?s.results:Array.isArray(s?.items)?s.items:[];$(),f(n),U(r,t,n)}catch(s){$();const n=P(s);a?.items?.length?(i(`<p>${n} — showing saved results from earlier.</p>`),f(a.items)):i(`<p>${n}</p>`)}finally{m&&(m.disabled=!1)}}const Y=l("#movieForm"),A=l("#movieResults"),g=l("#movieResultsBtn"),_=l("#movieGenre"),j=l("#minYear");let y=null;const d=[];function c(e){A&&(A.innerHTML=e)}function B(e){return[e?.primaryImage?.url,typeof e?.primaryImage=="string"?e.primaryImage:null,...Array.isArray(e?.thumbnails)?e.thumbnails.map(r=>r?.url):[],e?.posterUrl,e?.Poster,e?.poster,e?.imageUrl,e?.image,e?.img,e?.thumbnail].filter(Boolean).find(r=>typeof r=="string"&&/^https?:\/\//i.test(r))||null}function v(e=[]){if(!e?.length){c("<p>No movies found. Try another genre or year.</p>");return}const t=e.slice(0,5).map(r=>{const a=r?.primaryTitle||r?.originalTitle||r?.Title||r?.title||r?.name||r?.original_title||r?.titleText?.text||"Untitled",s=r?.startYear||r?.Year||r?.year||(r?.release_date?new Date(r.release_date).getFullYear():""),n=r?.Rating||r?.rating||r?.vote_average,o=B(r),u=o?`<img src="${o}" alt="" onerror="this.style.display='none'">`:"",k=[s?`(${s})`:"",n?`⭐ ${n}`:""].filter(Boolean).join(" ");return`
      <article class="card">
        ${u}
        <h3>${a}</h3>
        <p>${k}</p>
      </article>
    `}).join("");c(`<div class="grid">${t}</div>`)}const I=(e,t)=>`ddc:movies:${e}:${t}`;function F(e,t,r){localStorage.setItem(I(e,t),JSON.stringify({ts:Date.now(),items:r}))}function O(e,t){try{return JSON.parse(localStorage.getItem(I(e,t)))}catch{return null}}function w(){d.splice(0).forEach(clearTimeout)}function x(e,t){w(),d.push(setTimeout(()=>{c(`<p>Searching for <strong>${t}</strong> movies since <strong>${e}</strong>…</p>`)},0)),d.push(setTimeout(()=>{c("<p>Still looking… the movie provider can be slow during peak times.</p>")},8e3)),d.push(setTimeout(()=>{c("<p>Almost there… thanks for your patience.</p>")},2e4))}async function z(e){e.preventDefault();const t=_?.value?.trim(),r=j?.value?.trim();if(!t||!/^\d{4}$/.test(r||"")){c("<p>Please pick a genre and enter a 4-digit minimum year (e.g., 2020).</p>");return}g&&(g.disabled=!0);const a=O(r,t);a?.items?.length?(c('<p class="muted">Showing saved results from earlier while we fetch fresh data…</p>'),v(a.items)):c(`<p>Searching for <strong>${t}</strong> movies since <strong>${r}</strong>…</p>`),y?.abort(),y=new AbortController,x(r,t);try{const s=`/.netlify/functions/moviesSearch?${new URLSearchParams({MinYear:r,Genre:t})}`,n=await fetch(s,{signal:y.signal,headers:{accept:"application/json"}});if(!n.ok)throw new b(n.status,n.statusText);const o=await n.json(),u=Array.isArray(o)?o:Array.isArray(o?.items)?o.items:Array.isArray(o?.results)?o.results:Array.isArray(o?.data)?o.data:[];w(),v(u),F(r,t,u)}catch(s){w();const n=P(s);a?.items?.length?(c(`<p>${n} — showing saved results from earlier.</p>`),v(a.items)):c(`<p>${n}</p>`)}finally{g&&(g.disabled=!1)}}document.addEventListener("DOMContentLoaded",()=>{M?.addEventListener("submit",L),Y?.addEventListener("submit",z)});
