import"./base-DW4XMzFu.js";import{g as v}from"./restaurant-CdretbXj.js";async function w({MinYear:e,Genre:t,Limit:r=5},{signal:n}={}){const a=new URLSearchParams;e!=null&&a.set("MinYear",String(e)),t&&a.set("Genre",t),a.set("Limit",String(r??5));const o=async s=>{const i=await fetch(`${s}?${a}`,{signal:n,headers:{accept:"application/json"}});return ensureOk(i)};try{return await o("/.netlify/functions/moviesSearch")}catch(s){if(s?.status!==404)throw s}try{return await o("/.netlify/functions/moviesFilter")}catch(s){if(s?.status!==404)throw s}return getMoviesDirect({MinYear:e,Genre:t,Limit:r},{signal:n})}async function M(e,{direct:t=MOVIES_DIRECT_DEFAULT,signal:r}={}){if(!e||!e.Genre)throw new Error("Genre is required");if(e.MinYear==null)throw new Error("MinYear is required");return t?getMoviesDirect(e,{signal:r}):w(e,{signal:r})}const $=e=>new Promise(t=>setTimeout(t,e)),m=(...e)=>console.info("[randomGenerator]",...e);function g(e){if(Array.isArray(e))return e;for(const t of["results","items","data","restaurants","stores","list"])if(Array.isArray(e?.[t]))return e[t];return[]}function d(e){return typeof e=="string"&&/^https?:\/\//i.test(e)}function b(e={}){const t=e.imageUrl||e.image||e.img||e.thumbnail||e.photoUrl||e.photo||"";return{type:"food",id:e.id??e.storeId??e.slug??void 0,name:e.name||e.title||"Unnamed restaurant",category:e.category||e.cuisine||"",description:e.description||e.desc||"",image:d(t)?t:""}}function L(e={}){return[e?.primaryImage?.url,typeof e?.primaryImage=="string"?e.primaryImage:null,e?.posterUrl,e?.Poster,e?.poster,e?.imageUrl,e?.image,e?.img,e?.thumbnail,...Array.isArray(e?.thumbnails)?e.thumbnails.map(r=>r?.url):[],e?.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:null].filter(Boolean).find(r=>d(r))||""}function A(e={}){const t=e.primaryTitle||e.originalTitle||e.Title||e.title||e.name||e.original_title||e?.titleText?.text||"Untitled",r=e.description||e.overview||e.plot||e.synopsis||"",n=e.genre||e.Genre||(Array.isArray(e.genres)?e.genres[0]:""),a=e.Rating??e.rating??e.vote_average??null;return{type:"movie",id:e.id??e.tconst??void 0,title:t,description:r,genre:n,rating:a,image:L(e)}}function p(e,t){if(!Array.isArray(e)||e.length===0)throw new Error("No items available to pick from.");const r=Math.floor(Math.random()*e.length);for(let n=0;n<e.length;n++){const a=(r+n)%e.length,o=t(e[a]??{});if(d(o.image))return o}return t(e[r])}function I(e){const t=e?.status;return/NetworkError|Failed to fetch|timeout/i.test(e?.message||"")||t===429||t===408||t===425||t===423||t>=500&&t<=504}async function y(e,{preferDirect:t=!1,signal:r,triesPerMode:n=2,backoffMs:a=700}={}){const o=t?[!0,!1]:[!1,!0];for(const s of o){let i=0;for(;i<n;)try{return m(`mode=${s?"direct":"function"} attempt=${i+1}`),await e({direct:s,signal:r})}catch(c){if(m(`error in mode=${s?"direct":"function"} attempt=${i+1}`,c),i++,!s&&c?.status===404||s&&(c?.status===401||c?.status===403))break;if(i<n&&I(c)){await $(a*i);continue}throw c}}throw new Error("All fetch modes failed.")}async function E(e={}){const{params:t={address:"19122",resName:"sushi",limit:30},preferDirect:r=!0,signal:n}=e,a=await y(({direct:s,signal:i})=>v(t,{direct:s,signal:i}),{preferDirect:r,signal:n}),o=g(a);return p(o,b)}async function S(e={}){const{Genre:t="Action",MinYear:r=2020,Limit:n=30,preferDirect:a=!1,signal:o}=e,s=await y(({direct:c,signal:l})=>M({Genre:t,MinYear:r,Limit:n},{direct:c,signal:l}),{preferDirect:a,signal:o}),i=g(s);return p(i,A)}const h="/src/public/images/placeholder-generic.jpg";function T(e){const t=e.name??"Restaurant",r=e.image||h,n=e.description||"",a=e.category?`Category: ${e.category}`:"";return`
    <article class="card" data-type="food" data-name="${t}">
      <button class="heart-btn" aria-pressed="false">♡</button>
      <img src="${r}" alt="${t}">
      <div class="content">
        <h2>${t}</h2>
        <p class="meta">${a}</p>
        ${n?`<p class="desc">${n}</p>`:""}
      </div>
    </article>`}function k(e){const t=e.title??"Movie",r=e.image||h,n=e.description||"",a=[e.genre?`Genre: ${e.genre}`:"",e.rating!=null?`· Rating: ${e.rating}`:""].filter(Boolean).join(" ");return`
    <article class="card" data-type="movie" data-title="${t}">
      <button class="heart-btn" aria-pressed="false">♡</button>
      <img src="${r}" alt="${t}">
      <div class="content">
        <h2>${t}</h2>
        <p class="meta">${a}</p>
        ${n?`<p class="desc">${n}</p>`:""}
      </div>
    </article>`}function f(e){const t=e.querySelector(".heart-btn");t&&t.addEventListener("click",()=>{const r=t.closest(".card"),n=r.dataset.type,a=n==="movie"?r.dataset.title:r.dataset.name,o=r.querySelector("img")?.src||"",s=r.querySelector(".desc")?.textContent||"",i="favoriteList",c=JSON.parse(localStorage.getItem(i)||"[]"),l=c.findIndex(u=>u.type===n&&(u.name===a||u.title===a));l===-1?(c.push({type:n,name:a,title:n==="movie"?a:void 0,image:o,description:s,addedAt:new Date().toISOString()}),t.textContent="❤️",t.setAttribute("aria-pressed","true")):(c.splice(l,1),t.textContent="♡",t.setAttribute("aria-pressed","false")),localStorage.setItem(i,JSON.stringify(c))})}async function C(){const e=document.getElementById("foodMount"),t=document.getElementById("movieMount");e.innerHTML="<p>Loading restaurant...</p>",t.innerHTML="<p>Loading movie...</p>";const r=E({params:{address:"19122",resName:"sushi",limit:30}}),n=S({Genre:"Action",MinYear:2020,Limit:30}),[a,o]=await Promise.allSettled([r,n]);a.status==="fulfilled"?(e.innerHTML=T({...a.value}),f(e)):(console.error(a.reason),e.innerHTML="<p>Could not load restaurant.</p>"),o.status==="fulfilled"?(t.innerHTML=k({...o.value}),f(t)):(console.error(o.reason),t.innerHTML="<p>Could not load movie.</p>")}window.addEventListener("DOMContentLoaded",C);
