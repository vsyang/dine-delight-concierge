import"./base-DW4XMzFu.js";import{g as w}from"./restaurant-CdretbXj.js";async function v(e){if(!e.ok){const t=await e.text().catch(()=>""),n=new Error(`HTTP ${e.status} ${e.statusText}`);throw n.status=e.status,n.body=t,n}return e.json()}async function M({MinYear:e,Genre:t,Limit:n=5},{signal:r}={}){const a=new URLSearchParams;e!=null&&a.set("MinYear",String(e)),t&&a.set("Genre",t),a.set("Limit",String(n??5));const o=async s=>{const i=await fetch(`${s}?${a}`,{signal:r,headers:{accept:"application/json"}});return v(i)};try{return await o("/.netlify/functions/moviesSearch")}catch(s){if(s?.status!==404)throw s}try{return await o("/.netlify/functions/moviesFilter")}catch(s){if(s?.status!==404)throw s}return getMoviesDirect({MinYear:e,Genre:t,Limit:n},{signal:r})}async function $(e,{direct:t=MOVIES_DIRECT_DEFAULT,signal:n}={}){if(!e||!e.Genre)throw new Error("Genre is required");if(e.MinYear==null)throw new Error("MinYear is required");return t?getMoviesDirect(e,{signal:n}):M(e,{signal:n})}const b=e=>new Promise(t=>setTimeout(t,e)),m=(...e)=>console.info("[randomGenerator]",...e);function g(e){if(Array.isArray(e))return e;for(const t of["results","items","data","restaurants","stores","list"])if(Array.isArray(e?.[t]))return e[t];return[]}function d(e){return typeof e=="string"&&/^https?:\/\//i.test(e)}function L(e={}){const t=e.imageUrl||e.image||e.img||e.thumbnail||e.photoUrl||e.photo||"";return{type:"food",id:e.id??e.storeId??e.slug??void 0,name:e.name||e.title||"Unnamed restaurant",category:e.category||e.cuisine||"",description:e.description||e.desc||"",image:d(t)?t:""}}function A(e={}){return[e?.primaryImage?.url,typeof e?.primaryImage=="string"?e.primaryImage:null,e?.posterUrl,e?.Poster,e?.poster,e?.imageUrl,e?.image,e?.img,e?.thumbnail,...Array.isArray(e?.thumbnails)?e.thumbnails.map(n=>n?.url):[],e?.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:null].filter(Boolean).find(n=>d(n))||""}function T(e={}){const t=e.primaryTitle||e.originalTitle||e.Title||e.title||e.name||e.original_title||e?.titleText?.text||"Untitled",n=e.description||e.overview||e.plot||e.synopsis||"",r=e.genre||e.Genre||(Array.isArray(e.genres)?e.genres[0]:""),a=e.Rating??e.rating??e.vote_average??null;return{type:"movie",id:e.id??e.tconst??void 0,title:t,description:n,genre:r,rating:a,image:A(e)}}function p(e,t){if(!Array.isArray(e)||e.length===0)throw new Error("No items available to pick from.");const n=Math.floor(Math.random()*e.length);for(let r=0;r<e.length;r++){const a=(n+r)%e.length,o=t(e[a]??{});if(d(o.image))return o}return t(e[n])}function E(e){const t=e?.status;return/NetworkError|Failed to fetch|timeout/i.test(e?.message||"")||t===429||t===408||t===425||t===423||t>=500&&t<=504}async function y(e,{preferDirect:t=!1,signal:n,triesPerMode:r=2,backoffMs:a=700}={}){const o=t?[!0,!1]:[!1,!0];for(const s of o){let i=0;for(;i<r;)try{return m(`mode=${s?"direct":"function"} attempt=${i+1}`),await e({direct:s,signal:n})}catch(c){if(m(`error in mode=${s?"direct":"function"} attempt=${i+1}`,c),i++,!s&&c?.status===404||s&&(c?.status===401||c?.status===403))break;if(i<r&&E(c)){await b(a*i);continue}throw c}}throw new Error("All fetch modes failed.")}async function I(e={}){const{params:t={address:"19122",resName:"sushi",limit:30},preferDirect:n=!0,signal:r}=e,a=await y(({direct:s,signal:i})=>w(t,{direct:s,signal:i}),{preferDirect:n,signal:r}),o=g(a);return p(o,L)}async function S(e={}){const{Genre:t="Action",MinYear:n=2020,Limit:r=30,preferDirect:a=!1,signal:o}=e,s=await y(({direct:c,signal:l})=>$({Genre:t,MinYear:n,Limit:r},{direct:c,signal:l}),{preferDirect:a,signal:o}),i=g(s);return p(i,T)}const h="/src/public/images/placeholder-generic.jpg";function k(e){const t=e.name??"Restaurant",n=e.image||h,r=e.description||"",a=e.category?`Category: ${e.category}`:"";return`
    <article class="card" data-type="food" data-name="${t}">
      <button class="heart-btn" aria-pressed="false">♡</button>
      <img src="${n}" alt="${t}">
      <div class="content">
        <h2>${t}</h2>
        <p class="meta">${a}</p>
        ${r?`<p class="desc">${r}</p>`:""}
      </div>
    </article>`}function H(e){const t=e.title??"Movie",n=e.image||h,r=e.description||"",a=[e.genre?`Genre: ${e.genre}`:"",e.rating!=null?`· Rating: ${e.rating}`:""].filter(Boolean).join(" ");return`
    <article class="card" data-type="movie" data-title="${t}">
      <button class="heart-btn" aria-pressed="false">♡</button>
      <img src="${n}" alt="${t}">
      <div class="content">
        <h2>${t}</h2>
        <p class="meta">${a}</p>
        ${r?`<p class="desc">${r}</p>`:""}
      </div>
    </article>`}function f(e){const t=e.querySelector(".heart-btn");t&&t.addEventListener("click",()=>{const n=t.closest(".card"),r=n.dataset.type,a=r==="movie"?n.dataset.title:n.dataset.name,o=n.querySelector("img")?.src||"",s=n.querySelector(".desc")?.textContent||"",i="favoriteList",c=JSON.parse(localStorage.getItem(i)||"[]"),l=c.findIndex(u=>u.type===r&&(u.name===a||u.title===a));l===-1?(c.push({type:r,name:a,title:r==="movie"?a:void 0,image:o,description:s,addedAt:new Date().toISOString()}),t.textContent="❤️",t.setAttribute("aria-pressed","true")):(c.splice(l,1),t.textContent="♡",t.setAttribute("aria-pressed","false")),localStorage.setItem(i,JSON.stringify(c))})}async function C(){const e=document.getElementById("foodMount"),t=document.getElementById("movieMount");e.innerHTML="<p>Loading restaurant...</p>",t.innerHTML="<p>Loading movie...</p>";const n=I({params:{address:"19122",resName:"sushi",limit:30}}),r=S({Genre:"Action",MinYear:2020,Limit:30}),[a,o]=await Promise.allSettled([n,r]);a.status==="fulfilled"?(e.innerHTML=k({...a.value}),f(e)):(console.error(a.reason),e.innerHTML="<p>Could not load restaurant.</p>"),o.status==="fulfilled"?(t.innerHTML=H({...o.value}),f(t)):(console.error(o.reason),t.innerHTML="<p>Could not load movie.</p>")}window.addEventListener("DOMContentLoaded",C);
