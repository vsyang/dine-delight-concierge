import"./base-DQM_IlgI.js";class f extends Error{constructor(e,r,a){super(r||`HTTP ${e}`),this.name="HttpError",this.status=e,this.payload=a}}const y=!0,w="fb24daa4c6msha6df40407c42d23p1aaad1jsn13da9abc02b5";async function b(t){const e=await t.text();try{return{data:JSON.parse(e),raw:e}}catch{return{data:null,raw:e}}}async function g(t){if(!t.ok){const{data:e,raw:r}=await b(t),a=e?.message||e?.msg||e?.error||t.statusText;throw new f(t.status,a,e??r)}return t.json()}async function $({address:t,resName:e,country:r="United States"},{signal:a}={}){const n=new URLSearchParams({address:t,resName:e,country:r}),o=await fetch(`https://eater_ubereats.p.rapidapi.com/getUberEats?${n}`,{method:"GET",signal:a,headers:{"X-RapidAPI-Key":w,"X-RapidAPI-Host":"eater_ubereats.p.rapidapi.com",accept:"application/json"}});return g(o)}async function S({address:t,resName:e},{signal:r}={}){const a=new URLSearchParams({address:t,resName:e}),n=await fetch(`/.netlify/functions/ubereats?${a}`,{signal:r,headers:{accept:"application/json"}});return g(n)}async function P(t,{direct:e=y,signal:r}={}){return e?$(t,{signal:r}):S(t,{signal:r})}const i=t=>document.querySelector(t),v=i("#foodForm"),h=i("#results"),c=i("#resultsBtn"),A=i("#foodCategory"),E=i("#zip");let l=null;const u=[];function s(t){h&&(h.innerHTML=t)}function d(t=[]){if(!t?.length){s("<p>No results found. Try another category or ZIP.</p>");return}const e=t.slice(0,5).map(r=>{const a=r?.name||"Unnamed item",n=r?.price?` · ${r.price}`:"",o=r?.rating?` · ${r.rating}`:"";return`
      <article class="card">
        ${r?.imageUrl?`<img src="${r.imageUrl}" alt="" onerror="this.style.display='none'">`:""}
        <h3>${a}</h3>
        <p>${[n,o].filter(Boolean).join("")}</p>
      </article>
    `}).join("");s(`<div class="grid">${e}</div>`)}const m=(t,e)=>`ddc:cache:${t}:${e}`;function T(t,e,r){localStorage.setItem(m(t,e),JSON.stringify({ts:Date.now(),items:r}))}function I(t,e){try{return JSON.parse(localStorage.getItem(m(t,e)))}catch{return null}}function k(t){if(console.error("Search error:",t),t.name==="AbortError")return"Search was canceled.";if(t instanceof f){const e=t.status;return e===401||e===403?"Authorization problem with the search service. Please try again shortly.":e===404?"The search service endpoint was not found.":e===400||e===422?"Please pick a category and enter a valid 5-digit ZIP.":e===429?"We’re searching a bit too fast. Wait a minute and try again.":e>=500&&e<=504?"The food search service had a hiccup. Try again in a moment.":`Unexpected error (code ${e}).`}return/NetworkError|Failed to fetch/i.test(t.message)?"Network error — please check your connection.":/Missing VITE_RAPIDAPI_KEY/i.test(t.message)?"Setup issue: missing API key (dev-only).":"Something went wrong. Please try again."}function p(){u.splice(0).forEach(clearTimeout)}function U(t,e){p(),u.push(setTimeout(()=>{s(`<p>Searching for <strong>${e}</strong> near ${t}…</p>`)},0)),u.push(setTimeout(()=>{s("<p>Still looking… the provider can be slow during busy times.</p>")},8e3)),u.push(setTimeout(()=>{s("<p>Almost there… thanks for your patience.</p>")},2e4))}async function D(t){t.preventDefault();const e=A?.value?.trim(),r=E?.value?.trim();if(!e||!/^\d{5}$/.test(r||"")){s("<p>Please pick a category and enter a valid 5-digit ZIP.</p>");return}c&&(c.disabled=!0);const a=I(r,e);a?.items?.length?(s('<p class="muted">Showing saved results from earlier while we fetch fresh data…</p>'),d(a.items)):s(`<p>Searching for <strong>${e}</strong> near ${r}…</p>`),l?.abort(),l=new AbortController,U(r,e);try{const n=await P({address:r,resName:e},{signal:l.signal}),o=Array.isArray(n)?n:Array.isArray(n?.data)?n.data:Array.isArray(n?.results)?n.results:[];p(),d(o),T(r,e,o)}catch(n){p();const o=k(n);a?.items?.length?(s(`<p>${o} — showing saved results from earlier.</p>`),d(a.items)):s(`<p>${o}</p>`)}finally{c&&(c.disabled=!1)}}document.addEventListener("DOMContentLoaded",()=>{v?.addEventListener("submit",D)});
