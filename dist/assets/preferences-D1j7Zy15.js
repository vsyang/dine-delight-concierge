import"./base-DQM_IlgI.js";import{g as h,H as f}from"./restaurant-CdretbXj.js";const i=r=>document.querySelector(r),y=i("#foodForm"),p=i("#results"),c=i("#resultsBtn"),v=i("#foodCategory"),$=i("#zip");let u=null;const l=[];function n(r){p&&(p.innerHTML=r)}function d(r=[]){if(!r?.length){n("<p>No results found. Try another category or ZIP.</p>");return}const e=r.slice(0,5).map(t=>{const a=t?.name||"Unnamed item",s=t?.price?` · ${t.price}`:"";return`
      <article class="card">
        ${t?.imageUrl?`<img src="${t.imageUrl}" alt="" onerror="this.style.display='none'">`:""}
        <h3>${a}</h3>
        <p>${s}</p>
      </article>
    `}).join("");n(`<div class="grid">${e}</div>`)}const m=(r,e)=>`ddc:cache:${r}:${e}`;function w(r,e,t){localStorage.setItem(m(r,e),JSON.stringify({ts:Date.now(),items:t}))}function S(r,e){try{return JSON.parse(localStorage.getItem(m(r,e)))}catch{return null}}function b(r){if(console.error("Search error:",r),r.name==="AbortError")return"Search was canceled.";if(r instanceof f){const e=r.status;return e===401||e===403?"Authorization problem with the search service. Please try again shortly.":e===404?"The search service endpoint was not found.":e===400||e===422?"Please pick a category and enter a valid 5-digit ZIP.":e===429?"We’re searching a bit too fast. Wait a minute and try again.":e>=500&&e<=504?"The food search service had a hiccup. Try again in a moment.":`Unexpected error (code ${e}).`}return/NetworkError|Failed to fetch/i.test(r.message)?"Network error — please check your connection.":/Missing VITE_RAPIDAPI_KEY/i.test(r.message)?"Setup issue: missing API key (dev-only).":"Something went wrong. Please try again."}function g(){l.splice(0).forEach(clearTimeout)}function A(r,e){g(),l.push(setTimeout(()=>{n(`<p>Searching for <strong>${e}</strong> near ${r}…</p>`)},0)),l.push(setTimeout(()=>{n("<p>Still looking… the provider can be slow during busy times.</p>")},8e3)),l.push(setTimeout(()=>{n("<p>Almost there… thanks for your patience.</p>")},2e4))}async function P(r){r.preventDefault();const e=v?.value?.trim(),t=$?.value?.trim();if(!e||!/^\d{5}$/.test(t||"")){n("<p>Please pick a category and enter a valid 5-digit ZIP.</p>");return}c&&(c.disabled=!0);const a=S(t,e);a?.items?.length?(n('<p class="muted">Showing saved results from earlier while we fetch fresh data…</p>'),d(a.items)):n(`<p>Searching for <strong>${e}</strong> near ${t}…</p>`),u?.abort(),u=new AbortController,A(t,e);try{const s=await h({address:t,resName:e},{signal:u.signal}),o=Array.isArray(s)?s:Array.isArray(s?.data)?s.data:Array.isArray(s?.results)?s.results:[];g(),d(o),w(t,e,o)}catch(s){g();const o=b(s);a?.items?.length?(n(`<p>${o} — showing saved results from earlier.</p>`),d(a.items)):n(`<p>${o}</p>`)}finally{c&&(c.disabled=!1)}}document.addEventListener("DOMContentLoaded",()=>{y?.addEventListener("submit",P)});
